using GenerateCodeBaseServices.Models;
using Microsoft.Extensions.Configuration;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;

namespace GenerateAngularCSSPDBLocalModels
{
    public partial class Startup
    {
        private void CreateTypeFile(DLLTypeInfo dllTypeInfoModels, List<DLLTypeInfo> DLLTypeInfoCSSPDBModelsList)
        {
            StringBuilder sb = new StringBuilder();
            List<string> fileNameUsedList = new List<string>();
            List<string> removeTypeList = new List<string>()
            {
                "Int32", "Int16", "Int64", "Single", "Float", "Double", "String", "DateTime", "Boolean"
            };
            List<string> PropToSkip = new List<string>();

            sb.AppendLine(@"/*");
            sb.AppendLine($@" * Auto generated from { AppDomain.CurrentDomain.BaseDirectory }{ AppDomain.CurrentDomain.FriendlyName}.exe");
            sb.AppendLine(@" *");
            sb.AppendLine(@" * Do not edit this file.");
            sb.AppendLine(@" *");
            sb.AppendLine(@" */");
            sb.AppendLine(@"");

            sb.AppendLine(@"import { LocalDBCommandEnum } from 'src/app/enums/generated/LocalDBCommandEnum';");
            sb.AppendLine($@"import {{ { dllTypeInfoModels.Name } }} from 'src/app/models/generated/db/{ dllTypeInfoModels.Name }.model';");
            sb.AppendLine(@"");
            sb.AppendLine($@"export class Local{ dllTypeInfoModels.Name } extends { dllTypeInfoModels.Name } {{");
            sb.AppendLine(@"    LocalDBCommandEnum: LocalDBCommandEnum;");
            sb.AppendLine(@"}");

            sb.AppendLine(@"");


            FileInfo fiOutputGen = new FileInfo(Config.GetValue<string>("ModelFileName").Replace("{TypeName}", dllTypeInfoModels.Name));
            using (StreamWriter sw2 = fiOutputGen.CreateText())
            {
                sw2.Write(sb.ToString());
                Console.WriteLine($"Created { fiOutputGen.FullName }");
            }
        }
    }
}
